# example-react-flow 目标描述与任务进度

> 本文档记录 example-react-flow 子项目希望实现的主要功能目标，并根据当前实现情况动态规划任务进度。
> 信息依赖指引：
> - “1. 目标功能特性”为信息源，关于子项目的需求和目标细节以此为准。与 working-notes 文件夹第一级的“项目总览.md”相关，为“项目总览.md”所提到的设计理念进行具体探索。
> - “2. 当前与目标的差距”依赖于上一节“1. 目标功能特性”，以及代码仓库中的实际情况。
> - “3. 任务进度概述”依赖于“2.当前与目标的差距”，根据当前与目标的差距动态规划任务进度，将工作分解为若干个任务，按优先级排序。
> - “4. 正在进行的任务信息”用于记录当前正在进行的某一个任务的详细信息。需要确保一个新AI助手阅读这一节后能了解到接手这个任务须知的所有背景和状态信息。

## 1. 目标功能特性

### 设计风格

- 风格定位：极简、未来感、虚像性。
- 主色调：白色为主，淡蓝/青色为辅。

- 代码节点设计：
   - 容器：无背景、无阴影、无卡片感，常态下1px透明边框，选中/编辑/hover时边缘发光。
   - 代码区：等宽字体，白色，背景透明。
   - 求值区：等宽字体，淡蓝色，极细分割线，背景透明。
   - placeholder：等宽字体，极淡蓝色。
   - 编辑态和展示态下，代码区尺寸不变。
   - 交互反馈：hover/选中/编辑时发光边缘，优先级依次提升，极简克制。

### 功能特性

1. **自定义文本节点（代码片段节点）**：
   - 节点默认无背景、无边框，仅在选中/编辑/hover 时显示极细发光边缘，整体风格为极简、未来感、虚像性（白色为主，淡蓝/青色为辅）。
   - 代码区、求值区均为等宽字体。
   - 双击节点可进入编辑模式，支持多行代码输入，编辑态和展示态尺寸一致，求值区始终显示。
   - 节点本体承担主要交互区域，便于后续扩展更多功能。

2. **Floating Edge / 无锚点连接体验(参照 Excalidraw)**:
   - 取消固定连接点(handle)的显式交互，用户在"连接模式"下可直接在节点本体上按下鼠标并拖动以创建连接，无需操作具体锚点。实际上锚点变得跟节点相同大小，整个重叠并透明，整个节点都"变成了锚点"。
   - 连接线和连接点位置的计算方法应以节点间的最短路径直线为准，确保连接自然、简洁。
   - 连接线默认使用直线(Line)，后续可扩展为支持编辑为曲线（如贝塞尔曲线），但当前阶段仅需实现直线。
   - 连接线必须带有箭头，清晰指示数据流/依赖方向。
   - 这样做的优势：用户界面更简洁，操作更自然，且为后续实现 Excalidraw 式的智能连接点和用户微调功能打下基础。

3. **多模式工具栏与交互行为**:
   - 实现了模式切换工具栏，支持选择、文本和连接三种操作模式。
   - 不同模式下，画布和节点的交互行为如下：
     - **选择模式**：
       - 鼠标样式为"抓手"。
       - 双击画布空白处会立即创建一个文本/代码节点，模式不变。
       - 单击已有节点选中该节点，支持 ctrl 多选（React Flow 已原生支持 ctrl 多选，无需自定义实现）。
       - 双击已有节点进入编辑。
     - **文本模式**：
       - 鼠标样式为"十字线"。
       - 单击画布空白处创建新节点，并自动切回"选择"模式。
       - 在已有节点处，鼠标变为"编辑"样式，单击直接进入编辑。
     - **连接模式**：
       - 鼠标样式为"十字线"或"连接"指示。
       - 直接在节点本体按下鼠标并拖动到目标节点，完成连接。
   - 直观的视觉反馈，清晰指示当前活动模式。

---

## 2. 当前与目标的差距

本节用于记录 example-react-flow 当前实现与目标功能特性之间的差距。

- 细节交互（如文本模式下节点直接编辑、视觉反馈）持续优化中。
- 其它主流程已基本实现。
> 维护指导：请根据实际开发进展，补充未完成或有待优化的功能点。

---

## 3. 任务进度概述

本节根据当前与目标的差距，动态规划 example-react-flow 子项目的主要开发任务，按优先级排序：

1. **完善多模式下节点创建与编辑交互**
   - 已完成：
     - 选择/文本模式下节点创建、编辑、自动切换。
     - 编辑态和展示态尺寸一致，求值区始终显示。
     - 节点风格已升级为极简未来感风格。
   - 正在推进：
     - 视觉反馈、细节优化。

2. **优化连接方式为"拖动式"连接**
   - 已完成：节点本体直接拖动创建连接，无需操作具体锚点。

---

## 4. 正在进行的任务信息

本节用于记录当前正在进行的任务的详细信息。有时候需要新的 AI 助手来接手上一个 AI 助手负责的任务，这一节里会包括跟目前
任务相关的关键信息。
- 视觉反馈、细节持续优化。