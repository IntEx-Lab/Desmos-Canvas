# Julia Canvas Project Requirements and Planning
_Exported on 5/23/2025 at 16:33:38 GMT+8 from Cursor (0.50.5)_

---

**User**

刚才我和另一个AI整理了最后的需求，项目目前和目标的差距。
我后面需要和其他多个AI发起多个对话以逐步完成这些目标。但是我现在需要你帮忙做一下规划之类的，并更新相关文档。

# 画布式 Julia 代码环境需求梳理

## 1. 项目定位与目标

- **目标**：打造一个基于 Julia 的画布式编程环境，支持变量、表达式、公式对象的可视化、交互式编辑与复合，最终可导出并预览 Desmos 图像。
- **核心特色**：每个代码节点既是可编辑的 Julia 代码单元，也是可交互的数学对象或控件，支持变量联动、公式复用、图形化引用与自动依赖追踪。
- **后端基础**：依赖自研的 Bernard.jl 库，负责表达式捕获、公式对象生成、Desmos 结构导出等核心逻辑。

---

## 2. 变量与表达式的控件支持

### 2.1 基本变量定义

- **场景**：如 `a = 3` 或 `@desmos a = 3`
- **控件支持**：
  - 画布节点下方自动生成滑动条（数值）、输入框（文本）、勾选框（布尔值）等控件，直接联动变量值。
  - 控件变动时，自动修改节点代码并触发下游依赖节点的自动更新。
  - 支持动画（如滑动条自动播放，变量值动态变化）。

### 2.2 公式对象与表达式

- **场景**：如 `formula_1 = @desmos y = a * x^2` 或 `@desmos x^2 + y^2 = a^2`
- **控件支持**：
  - 如果公式对象本身包含可控变量（如 `a`），则控件区自动联动这些变量。
  - 公式对象节点可直接生成 Desmos 预览，无需额外操作。
  - 支持对公式对象的进一步复合与引用。

### 2.3 复杂对象与图表

- **场景**：如 `graph = Graph(...)`
- **控件支持**：
  - 只要对象结构中包含可控变量，控件区自动渲染所有可控参数。
  - 该节点可直接生成完整的 Desmos 图表预览。
  - 支持从任意层级（表达式、公式、公式列表、完整图表）生成 Desmos 预览，提升灵活性和便携性。

---

## 3. Desmos 预览与导出

- **支持范围**：
  - 任何由 Bernard.jl 生成的公式对象、公式列表、图表对象节点，都可以一键生成 Desmos 预览。
  - 预览方式可为内嵌 Desmos 组件或新窗口打开。
- **导出功能**：
  - 支持将当前节点（或选定节点）导出为 Desmos 可识别的 JSON、LaTeX 或其他格式。
  - 支持批量导出、导入、分享等操作。

---

## 4. 变量与表达式的命名与复用机制

- **自动依赖追踪**：
  - 画布自动分析每个节点的变量依赖关系，构建有向无环图（DAG），保证求值顺序正确。
  - 上游变量变动时，下游节点自动响应更新。
- **匿名表达式的复用**：
  - 对于未赋名的表达式节点，系统自动分配临时变量名（如 `_tmp1`），后续节点可直接引用。
  - 用户可一键将临时变量重命名为有意义的名字，系统自动同步所有引用。
  - 支持图形化引用（如拖拽、右键菜单等），提升复用体验。
- **引用关系可视化**：
  - 选中节点时，高亮显示所有相关依赖边和引用关系，便于理解和调试。

---

## 5. 画布状态的持久化与导入导出

- **自动保存**：所有节点、边、变量、控件状态等自动保存到本地（如 localStorage），下次打开自动恢复。
- **导入导出**：支持将整个画布状态导出为 JSON 文件，便于备份、迁移和分享。
- **版本兼容**：数据结构带版本号，便于未来升级和兼容。

---

## 6. Bernard.jl 的角色与接口

- **核心职责**：
  - 负责捕获 Julia 代码中的表达式、变量定义、公式对象等，并生成结构化的数学对象。
  - 提供 API 支持前端控件区的类型识别与控件生成。
  - 支持公式对象的复合、列表化、属性扩展等操作。
  - 实现 Desmos 结构的导出与预览接口。
- **前后端协作**：
  - 前端负责画布交互、控件渲染、依赖追踪等，后端 Bernard.jl 负责表达式解析、公式对象生成和 Desmos 集成。
  - 前后端通过 API 通信，前端传递代码片段，后端返回结构化对象和可视化数据。

---

## 7. 交互体验与可扩展性

- **多层次控件支持**：无论是基础变量、公式对象还是完整图表，只要有可控参数，都能自动生成控件区，支持联动和动画。
- **便携性与灵活性**：任意层级的对象都能直接生成 Desmos 预览，支持从表达式到图表的全流程可视化。
- **未来扩展**：支持更多类型（如向量、矩阵、函数等）、更多控件（如颜色选择、下拉菜单等）、更丰富的导出格式和交互方式。

---

## 8. 示例说明

```julia
a = 3                # 生成滑动条控件，可动画
@desmos a = 3        # 生成滑动条控件，可动画，且为公式对象
formula_1 = @desmos y = a * x^2   # 生成 Desmos 预览，控件区联动 a
@desmos x^2 + y^2 = a^2           # 生成 Desmos 预览，控件区联动 a
graph = Graph(...)   # 生成完整 Desmos 图表预览，控件区联动所有参数
```



---

**Cursor**

非常感谢你详细梳理了需求！你现在需要的是：

1. **将上述需求拆解为可分阶段推进的任务规划**，便于后续分配给不同AI或开发者。
2. **更新 working-notes/项目总览.md** 和 **working-notes/example-react-flow/目标描述与任务进度.md**，让新AI能直接了解最新目标和任务分解。
3. **给出后续协作建议**，比如如何分工、如何归档进展等。

下面是我的建议和具体操作方案：

---

## 一、任务分解与阶段规划

### 阶段1：基础画布与节点能力升级
- [ ] 1.1 代码节点支持 Julia 语法高亮与基本编辑（可先用 contentEditable，后续可集成更强编辑器）
- [ ] 1.2 节点数据结构扩展，支持变量、表达式、公式对象等类型标记
- [ ] 1.3 节点下方控件区基础实现（滑动条、输入框、勾选框等，自动识别变量类型）
- [ ] 1.4 节点间依赖关系自动追踪与高亮显示

### 阶段2：Bernard.jl 后端集成与表达式解析
- [ ] 2.1 设计前后端 API 协议（前端传代码片段，后端返回结构化对象/控件描述/依赖信息）
- [ ] 2.2 集成 Bernard.jl，支持表达式捕获、变量/公式对象识别
- [ ] 2.3 前端根据后端返回动态渲染控件区和 Desmos 预览

### 阶段3：Desmos 预览与导出
- [ ] 3.1 节点级 Desmos 预览（内嵌或新窗口）
- [ ] 3.2 支持导出 Desmos JSON/LaTeX
- [ ] 3.3 支持批量导出/导入/分享

### 阶段4：高级交互与可扩展性
- [ ] 4.1 变量动画与控件联动
- [ ] 4.2 匿名表达式自动命名与一键重命名
- [ ] 4.3 图形化引用与依赖关系可视化
- [ ] 4.4 支持更多类型（向量、矩阵、函数等）和控件（颜色选择、下拉菜单等）

### 阶段5：画布状态持久化与版本兼容
- [ ] 5.1 画布状态自动保存/恢复
- [ ] 5.2 导入导出 JSON，带版本号
- [ ] 5.3 兼容未来节点/边/控件类型扩展

---

## 二、文档更新建议

### 1. working-notes/项目总览.md

- **补充“最新需求与任务分解”一节**，简要说明 Julia 画布式编程环境的定位、核心目标、阶段性任务。
- **强调 Bernard.jl 的后端角色**，以及前后端协作模式。
- **说明协作与归档规范**，便于多AI/多开发者协作。

### 2. working-notes/example-react-flow/目标描述与任务进度.md

- **在“1. 目标功能特性”后补充“2. 近期升级目标”**，将你刚才的需求摘要和任务分解纳入，明确后续开发重点。
- **在“3. 任务进度概述”中，按阶段列出任务清单**，并注明每个任务的当前状态（未开始/进行中/已完成）。
- **在“4. 正在进行的任务信息”中，记录当前主攻的子任务及其背景**，便于新AI快速接手。

---

## 三、协作建议

- **每个阶段/子任务单独归档进展**，如在 working-notes/example-react-flow/ 下新建子任务文档。
- **每次任务切换或交接时，务必在“正在进行的任务信息”中补充背景和进展**。
- **所有设计决策、接口协议、踩坑记录等，优先归档到 working-notes/example-react-flow/技术笔记.md**。

---

## 四、下一步操作

我将：
1. 按上述思路更新 `working-notes/项目总览.md` 和 `working-notes/example-react-flow/目标描述与任务进度.md`，补充最新需求、任务分解和协作建议。
2. 保证文档结构清晰，便于后续AI和开发者直接查阅和接手。

请稍等，我马上进行文档更新。

```markdown

## 最新需求与任务分解

### 项目定位与目标
- 打造一个基于 Julia 的画布式编程环境，支持变量、表达式、公式对象的可视化、交互式编辑与复合，最终可导出并预览 Desmos 图像。
- 每个代码节点既是可编辑的 Julia 代码单元，也是可交互的数学对象或控件，支持变量联动、公式复用、图形化引用与自动依赖追踪。
- 后端依赖自研 Bernard.jl 库，负责表达式捕获、公式对象生成、Desmos 结构导出等核心逻辑。

### 阶段性任务规划
1. 基础画布与节点能力升级
   - 代码节点支持 Julia 语法高亮与基本编辑
   - 节点数据结构扩展，支持变量、表达式、公式对象等类型标记
   - 节点下方控件区基础实现（滑动条、输入框、勾选框等，自动识别变量类型）
   - 节点间依赖关系自动追踪与高亮显示
2. Bernard.jl 后端集成与表达式解析
   - 设计前后端 API 协议（前端传代码片段，后端返回结构化对象/控件描述/依赖信息）
   - 集成 Bernard.jl，支持表达式捕获、变量/公式对象识别
   - 前端根据后端返回动态渲染控件区和 Desmos 预览
3. Desmos 预览与导出
   - 节点级 Desmos 预览（内嵌或新窗口）
   - 支持导出 Desmos JSON/LaTeX
   - 支持批量导出/导入/分享
4. 高级交互与可扩展性
   - 变量动画与控件联动
   - 匿名表达式自动命名与一键重命名
   - 图形化引用与依赖关系可视化
   - 支持更多类型（向量、矩阵、函数等）和控件（颜色选择、下拉菜单等）
5. 画布状态持久化与版本兼容
   - 画布状态自动保存/恢复
   - 导入导出 JSON，带版本号
   - 兼容未来节点/边/控件类型扩展

### Bernard.jl 的角色与前后端协作
- Bernard.jl 负责捕获 Julia 代码中的表达式、变量定义、公式对象等，并生成结构化的数学对象。
- 提供 API 支持前端控件区的类型识别与控件生成。
- 支持公式对象的复合、列表化、属性扩展等操作。
- 实现 Desmos 结构的导出与预览接口。
- 前端负责画布交互、控件渲染、依赖追踪等，后端 Bernard.jl 负责表达式解析、公式对象生成和 Desmos 集成。
- 前后端通过 API 通信，前端传递代码片段，后端返回结构化对象和可视化数据。

```

```markdown

### 2. 近期升级目标

本节补充2024年6月最新需求梳理，明确后续开发重点：

- 打造基于 Julia 的画布式编程环境，支持变量、表达式、公式对象的可视化、交互式编辑与复合，最终可导出并预览 Desmos 图像。
- 每个代码节点既是可编辑的 Julia 代码单元，也是可交互的数学对象或控件，支持变量联动、公式复用、图形化引用与自动依赖追踪。
- 后端依赖 Bernard.jl，负责表达式捕获、公式对象生成、Desmos 结构导出等核心逻辑。
- 具体任务分阶段推进，详见下文。

---

## 3. 任务进度概述

本节根据最新需求，按阶段列出主要开发任务，并注明当前状态：

### 阶段1：基础画布与节点能力升级
- [ ] 1.1 代码节点支持 Julia 语法高亮与基本编辑（可先用 contentEditable，后续可集成更强编辑器）
- [ ] 1.2 节点数据结构扩展，支持变量、表达式、公式对象等类型标记
- [ ] 1.3 节点下方控件区基础实现（滑动条、输入框、勾选框等，自动识别变量类型）
- [ ] 1.4 节点间依赖关系自动追踪与高亮显示

### 阶段2：Bernard.jl 后端集成与表达式解析
- [ ] 2.1 设计前后端 API 协议（前端传代码片段，后端返回结构化对象/控件描述/依赖信息）
- [ ] 2.2 集成 Bernard.jl，支持表达式捕获、变量/公式对象识别
- [ ] 2.3 前端根据后端返回动态渲染控件区和 Desmos 预览

### 阶段3：Desmos 预览与导出
- [ ] 3.1 节点级 Desmos 预览（内嵌或新窗口）
- [ ] 3.2 支持导出 Desmos JSON/LaTeX
- [ ] 3.3 支持批量导出/导入/分享

### 阶段4：高级交互与可扩展性
- [ ] 4.1 变量动画与控件联动
- [ ] 4.2 匿名表达式自动命名与一键重命名
- [ ] 4.3 图形化引用与依赖关系可视化
- [ ] 4.4 支持更多类型（向量、矩阵、函数等）和控件（颜色选择、下拉菜单等）

### 阶段5：画布状态持久化与版本兼容
- [ ] 5.1 画布状态自动保存/恢复
- [ ] 5.2 导入导出 JSON，带版本号
- [ ] 5.3 兼容未来节点/边/控件类型扩展

---

（后续每次任务切换或交接时，请在“4. 正在进行的任务信息”中补充背景和进展，便于新AI快速接手。）

```

已完成如下操作：

1. **working-notes/项目总览.md**  
   - 新增了“最新需求与任务分解”一节，简要总结了 Julia 画布式编程环境的定位、核心目标、阶段性任务，并强调了 Bernard.jl 后端角色和前后端协作模式。

2. **working-notes/example-react-flow/目标描述与任务进度.md**  
   - 在“1.目标功能特性”后新增了“2. 近期升级目标”，补充了你刚才的需求摘要和任务分解。
   - 在“3.任务进度概述”中，按阶段列出了任务清单，并注明了每个任务的当前状态（初始均为未开始）。

这样，后续无论是你还是其他AI/开发者，都可以直接查阅最新的需求、分阶段任务和协作模式，快速接手和推进项目。

---

**协作建议补充：**
- 建议每个阶段/子任务推进时，在 `working-notes/example-react-flow/` 下新建如 `阶段1-节点能力升级.md` 这样的子文档，详细记录设计、实现、踩坑和进展。
- 每次任务切换或交接时，务必在“4. 正在进行的任务信息”中补充背景和进展。
- 设计决策、接口协议、技术细节等优先归档到 `技术笔记.md`，便于长期积累和新成员快速上手。

如需进一步细化某一阶段的任务、分工建议或技术方案，随时告知！

---

**User**

另外我再补充一下：
- 现在是2025年5月23日
- 在项目目标上我们的重心发生变化。我们团队目前在寻找、拉拢高技术力成员方面有很大困难。一方面我们的故事很难讲好；另一方面目前感兴趣的潜在新成员技术力不足，无法一下子成长，他们只有数理知识和Desmos的熟练使用和创作能力。所以，现在相对不看重”对Para/Parasee的完整技术栈探索“了，现在更侧重能尽快实现”Julia+Bernard.jl+Desmos+React flow实现画布式编程与图象创作“，一来这个原型完成之后，更方便讲解”画布式编程与图象创作“的概念，虽然后续Para/Parasee与Julia、Desmos无关，但这个例子也能很好的展示我们的这个概念，展示体验和优势，更容易说服人。另一方面，这个原型本身也是对Desmos爱好者圈子的一大重器，有了它不仅能回复我们在Desmos圈的热度，也能给那行感兴趣的Desmos背景的潜在成员一个有效参与团队工作的机会，因为JuliaCanvas可以让他们真正高效的使用Desmos本身来完成一些设计、动画、艺术探索方面的工作，将生产力和效率提高到接近专业水平，而不必立刻学习专业技能，绕开专业艺术技能的限制。

---

**Cursor**

你的补充非常重要，直接影响了项目的定位、优先级和对外叙事。下面我会：

1. **总结你的新战略重心**，并用简明语言归纳为“项目目标调整”。
2. **更新 working-notes/项目总览.md**，在“最新需求与任务分解”前增加“2025年5月项目目标调整”小节，明确当前阶段的战略重心和叙事重点。
3. **更新 working-notes/example-react-flow/目标描述与任务进度.md**，在“2. 近期升级目标”前补充“2025年5月项目目标调整”说明，便于后续AI和新成员理解当前的优先级和团队策略。

---

### 1. 项目目标调整总结

#### 2025年5月项目目标调整（摘要）

- **战略重心转移**：不再以“Para/Parasee完整技术栈探索”为首要目标，而是聚焦于“Julia+Bernard.jl+Desmos+React Flow”原型的快速落地。
- **叙事与团队建设**：优先打造一个能直观展示“画布式编程与图象创作”理念的原型，便于对外讲故事、吸引和说服新成员。
- **面向Desmos圈层**：该原型将极大提升Desmos爱好者的生产力和创作体验，让他们无需专业技能即可高效参与动画、艺术、设计等工作，也为团队吸纳Desmos背景的成员提供了实际参与和成长的路径。
- **后续可扩展性**：虽然未来Para/Parasee可能与Julia、Desmos无关，但本原型的理念和体验可迁移，是团队叙事和技术积累的重要资产。

---

### 2. 文档更新计划

- **项目总览.md**：在“最新需求与任务分解”前插入“2025年5月项目目标调整”小节，内容如上摘要。
- **目标描述与任务进度.md**：在“2. 近期升级目标”前插入同样的“2025年5月项目目标调整”说明。

---

我将立即进行文档更新。

```markdown

## 2025年5月项目目标调整

- **战略重心转移**：不再以“Para/Parasee完整技术栈探索”为首要目标，而是聚焦于“Julia+Bernard.jl+Desmos+React Flow”原型的快速落地。
- **叙事与团队建设**：优先打造一个能直观展示“画布式编程与图象创作”理念的原型，便于对外讲故事、吸引和说服新成员。
- **面向Desmos圈层**：该原型将极大提升Desmos爱好者的生产力和创作体验，让他们无需专业技能即可高效参与动画、艺术、设计等工作，也为团队吸纳Desmos背景的成员提供了实际参与和成长的路径。
- **后续可扩展性**：虽然未来Para/Parasee可能与Julia、Desmos无关，但本原型的理念和体验可迁移，是团队叙事和技术积累的重要资产。


```

```markdown

### 2025年5月项目目标调整

- **战略重心转移**：不再以“Para/Parasee完整技术栈探索”为首要目标，而是聚焦于“Julia+Bernard.jl+Desmos+React Flow”原型的快速落地。
- **叙事与团队建设**：优先打造一个能直观展示“画布式编程与图象创作”理念的原型，便于对外讲故事、吸引和说服新成员。
- **面向Desmos圈层**：该原型将极大提升Desmos爱好者的生产力和创作体验，让他们无需专业技能即可高效参与动画、艺术、设计等工作，也为团队吸纳Desmos背景的成员提供了实际参与和成长的路径。
- **后续可扩展性**：虽然未来Para/Parasee可能与Julia、Desmos无关，但本原型的理念和体验可迁移，是团队叙事和技术积累的重要资产。


```

已完成如下更新：

1. **working-notes/项目总览.md**  
   - 在“最新需求与任务分解”前插入了“2025年5月项目目标调整”小节，明确了当前阶段的战略重心和叙事重点。

2. **working-notes/example-react-flow/目标描述与任务进度.md**  
   - 在“2. 近期升级目标”前插入了同样的“2025年5月项目目标调整”说明，便于后续AI和新成员理解当前的优先级和团队策略。

这样，任何新成员或AI都能一目了然地了解项目当前的战略重心、叙事重点和团队建设思路，后续推进和对外沟通会更加顺畅。

如需进一步细化叙事、对外宣传材料、或针对Desmos圈层的具体功能优先级调整，随时告知！

